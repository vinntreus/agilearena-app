extends ../layout

block body 
  .page-header
    h1= backlog.name
      a.btn.pull-right(href="/backlogs/#{backlog._id}/admin")
        i.icon-wrench
        = ' Admin'
      a.btn.pull-right(href="/backlogs/#{backlog._id}/0") History
    
  .well
    form.form-inline(method='post', action='/backlog-item/create', id='add_backlogitem')
      input(type="hidden", id='backlog_id', name='backlog_id', value='#{backlog._id}')  
      .controls
        span= 'Add item '
        input.input-xlarge(type="text", name='backlog_item[description]', autofocus='autofocus') 
        = ' '
        button.btn(type="submit") Save

  include toolbar 

  table.table.table-condensed.backlog-items
    thead
      tr
        th(width='2%')
        th(width='5%') #
        th Description      
    tbody
      each item, i in backlog.items
        tr(data-id="#{item._id}")
          td
            input(type='checkbox')
          td #{i + 1}
          td
            span(class="item-description") #{item.description}
            each label in item.labels || []
              span(class="label label-info") #{label}

//script(type='text/javascript', src='/backlog_show.js')  
  script(type='text/javascript', src='/backlog_labels.js')
  script(type='text/javascript')
    var backlogItems = !{JSON.stringify(backlog.items)};
    var view = new BacklogView(backlogItems);
    view.init();
    labels.init();